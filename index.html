<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/png" href="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png">
    <title>Verificador de Agendamientos en linea - TUM</title>
    
    <!-- Google Fonts: Inter para look Apple / Profesional -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* --- RESET & VARIABLES ESTILO APPLE --- */
        * { 
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }
        
        :root {
            /* Paleta Apple Grises */
            --apple-bg: #F5F5F7;
            --apple-surface: #FFFFFF;
            --apple-text-main: #1D1D1F;
            --apple-text-secondary: #86868B;
            --apple-border: #D2D2D7;
            
            /* Acentos */
            --apple-blue: #0071E3;
            --apple-blue-hover: #0077ED;
            --apple-green: #34C759;
            
            /* Sombras sutiles */
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
            --shadow-lg: 0 12px 24px rgba(0,0,0,0.08);
            
            --radius-apple: 18px;
            --radius-input: 12px;
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--apple-bg);
            color: var(--apple-text-main);
            line-height: 1.5;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        header {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--apple-border);
            position: sticky;
            top: 0;
            z-index: 50;
            padding: 1rem 0;
        }

        .container {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 1.5rem;
            width: 100%;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-img {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .logo-text h1 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--apple-text-main);
            letter-spacing: -0.01em;
        }

        .logo-text p {
            font-size: 0.8rem;
            color: var(--apple-text-secondary);
            font-weight: 400;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-link {
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .support-link {
            background: #F5F5F7;
            color: var(--apple-text-main);
        }
        .support-link:hover { background: #E8E8ED; }

        .whatsapp-link {
            background: white;
            border: 1px solid var(--apple-border);
            color: var(--apple-green);
        }
        .whatsapp-link:hover {
            background: #F0FFF4;
            border-color: var(--apple-green);
        }

        /* --- HERO SECTION CENTRADO --- */
        .hero-section {
            text-align: center;
            padding: 6rem 0 3rem;
            transition: padding 0.4s ease;
        }

        .hero-section.with-results {
            padding: 3rem 0 2rem;
        }

        .hero-section h1 {
            color: var(--apple-text-main);
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }

        .hero-section .subtitle {
            color: var(--apple-text-secondary);
            font-size: 1.125rem;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto 3rem;
        }

        /* --- SEARCH BOX CENTRADO Y DESTACADO --- */
        .search-box-wrapper {
            max-width: 540px;
            margin: 0 auto;
        }

        .search-input-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 1.25rem 1.5rem;
            font-size: 1.125rem;
            border-radius: var(--radius-input);
            border: 2px solid var(--apple-border);
            background: var(--apple-surface);
            transition: all 0.2s ease;
            font-weight: 500;
            color: var(--apple-text-main);
            box-shadow: var(--shadow-sm);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        .search-input::placeholder {
            color: var(--apple-text-secondary);
            font-weight: 400;
        }

        .search-button {
            width: 100%;
            padding: 1rem 1.5rem;
            background: var(--apple-blue);
            color: white;
            border: none;
            border-radius: var(--radius-input);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-md);
        }

        .search-button:hover:not(:disabled) {
            background: var(--apple-blue-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .search-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* --- ERROR MESSAGE --- */
        .error-message {
            background: #FFF3F3;
            border: 1px solid #FFD7D7;
            color: #D40000;
            padding: 1rem;
            border-radius: var(--radius-input);
            margin-top: 1rem;
            font-size: 0.9rem;
            text-align: center;
        }

        /* --- ESTADÍSTICAS (Inicialmente ocultas) --- */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-bottom: 3rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
        }

        .stats-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .stat-card {
            background: var(--apple-surface);
            padding: 1.5rem 1rem;
            border-radius: var(--radius-apple);
            text-align: center;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.03);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--apple-text-main);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--apple-text-secondary);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* --- MAIN RECORD CARD --- */
        .main-record-card {
            background: white;
            border-radius: var(--radius-apple);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
            border: 1px solid rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .main-record-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .record-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-realizado {
            background: var(--apple-blue);
            color: white;
        }

        .status-en-hora {
            background: var(--apple-green);
            color: white;
        }

        .status-pendiente {
            background: #FF9500;
            color: white;
        }

        .record-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--apple-text-secondary);
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .info-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--apple-text-main);
        }

        .payment-summary {
            background: #F5F5F7;
            padding: 1.25rem;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-label {
            font-size: 0.9rem;
            color: var(--apple-text-secondary);
        }

        .payment-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--apple-green);
        }

        /* --- HISTORIAL --- */
        .history-section {
            background: white;
            border-radius: var(--radius-apple);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid rgba(0,0,0,0.03);
        }

        .history-header {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--apple-text-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .compact-record {
            padding: 1rem;
            border-bottom: 1px solid #F5F5F7;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .compact-record:last-child {
            border-bottom: none;
        }

        .compact-record:hover {
            background: #FAFAFA;
        }

        .compact-record-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .compact-info {
            flex: 1;
        }

        .compact-status {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--apple-text-secondary);
            margin-bottom: 4px;
        }

        .compact-name {
            font-weight: 500;
            color: var(--apple-text-main);
            margin-bottom: 4px;
        }

        .compact-date {
            font-size: 0.85rem;
            color: var(--apple-text-secondary);
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 1rem;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-apple);
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 24px 48px rgba(0,0,0,0.2);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header-bg {
            text-align: center;
            padding: 2rem 1.5rem 1.5rem;
            background: linear-gradient(135deg, #F5F5F7 0%, #FFFFFF 100%);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .modal-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            padding: 1.5rem;
        }

        .modal-field-box {
            background: #F5F5F7;
            padding: 1rem;
            border-radius: 10px;
        }

        .modal-field-label-box {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--apple-text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .modal-field-value-box {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--apple-text-main);
        }

        .modal-close {
            position: sticky;
            bottom: 0;
            background: white;
            border-top: 1px solid rgba(0,0,0,0.05);
            padding: 1rem 1.5rem;
        }

        .close-button {
            width: 100%;
            padding: 0.875rem;
            background: var(--apple-blue);
            color: white;
            border: none;
            border-radius: var(--radius-input);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-button:hover {
            background: var(--apple-blue-hover);
        }

        /* --- UTILITIES --- */
        .hidden {
            display: none !important;
        }

        /* --- FADE IN ANIMATION --- */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.4s ease;
        }

        /* --- SPINNER --- */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- RESPONSIVE --- */
        @media (max-width: 640px) {
            .hero-section h1 {
                font-size: 2rem;
            }

            .hero-section .subtitle {
                font-size: 1rem;
            }

            .search-input {
                font-size: 1rem;
                padding: 1rem 1.25rem;
            }

            .header-actions {
                gap: 6px;
            }

            .header-link {
                padding: 6px 12px;
                font-size: 0.8rem;
            }

            .logo-img {
                width: 40px;
                height: 40px;
            }

            .modal-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <img src="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png" alt="TUM Logo" class="logo-img">
                    <div class="logo-text">
                        <h1> TUM </h1>
                        <!--<p>Sistema de Verificación</p>-->
                    </div>
                </div>
                <div class="header-actions">
                    <a href="#" class="header-link support-link">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                            <circle cx="12" cy="17" r="0.5" fill="currentColor"></circle>
                        </svg>
                        Soporte
                    </a>
                    <a href="https://wa.me/593963114440?text=Hola%2C%20necesito%20ayuda%20con%20mi%20agendamiento" target="_blank" class="header-link whatsapp-link">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                        </svg>
                        WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <div class="hero-section" id="heroSection">
        <div class="container">
            <h1>Mi Agenda</h1>
            <p class="subtitle">Ingresa tu código para ver el estado de tus agendamientos</p>
            
            <!-- Search Box -->
            <div class="search-box-wrapper">
                <form id="searchForm">
                    <div class="search-input-container">
                        <input 
                            type="text" 
                            id="searchInput" 
                            class="search-input" 
                            placeholder="Ej: CLI-12345"
                            required
                            autocomplete="off"
                        >
                    </div>
                    <button type="submit" id="searchButton" class="search-button">
                        Consultar Estado
                    </button>
                </form>
                
                <!-- Error Message -->
                <div id="errorMessage" class="error-message hidden"></div>
            </div>
        </div>
    </div>

    <!-- Statistics Section (Inicialmente oculto) -->
    <div class="container">
        <div id="statsSection" class="stats-section hidden">
            <div class="stat-card">
                <div class="stat-value" id="totalServicios">0</div>
                <div class="stat-label">Total Servicios</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="realizados">0</div>
                <div class="stat-label">Realizados</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pendientes">0</div>
                <div class="stat-label">Pendientes</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalPagado">$0</div>
                <div class="stat-label">Total Pagado</div>
            </div>
        </div>

        <!-- Results Container (Inicialmente oculto) -->
        <div id="recordsContainer" class="hidden">
            <!-- Main Record -->
            <div id="mainRecord"></div>

            <!-- History Section -->
            <div class="history-section">
                <div class="history-header">Historial de Servicios</div>
                <div id="otherRecords"></div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modalOverlay" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="modalBody"></div>
            <div class="modal-close">
                <button onclick="closeModal()" class="close-button">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwJObvioLWCc1ChDBwj3Kag77whhtdzT8TzwxB9zUgD4ECV9avQ717vl6uh7wGmvWkR/exec';
        let allRecords = [];

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return dateStr;
            
            const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            
            return `${day} ${month} ${year}`;
        }

        function getStatus(record) {
            const enHora = record['En Hora'] === 'TRUE' || record['En Hora'] === true;
            const realizado = record['Realizado'] === 'TRUE' || record['Realizado'] === true;

            if (realizado) return { label: 'Realizado', class: 'realizado' };
            if (enHora) return { label: 'En Hora', class: 'en-hora' };
            return { label: 'Pendiente', class: 'pendiente' };
        }

        function updateStatistics(records) {
            const total = records.length;
            let realizados = 0;
            let enHora = 0;
            let totalPagado = 0;

            records.forEach(record => {
                const realizado = record.data['Realizado'] === 'TRUE' || record.data['Realizado'] === true;
                const enHoraVal = record.data['En Hora'] === 'TRUE' || record.data['En Hora'] === true;
                
                if (realizado) realizados++;
                if (enHoraVal) enHora++;
                
                totalPagado += parseFloat(record.data['RC_Pagos_Total']) || 0;
            });

            const pendientes = total - realizados;

            document.getElementById('totalServicios').textContent = total;
            document.getElementById('realizados').textContent = realizados;
            document.getElementById('pendientes').textContent = pendientes;
            document.getElementById('totalPagado').textContent = `$${totalPagado.toFixed(2)}`;
        }

        function createMainRecordCard(record, index) {
            const cliente = record.data['RS_Nombre'] || '-';
            const codigo = record.data['RS_Id_Susc'] || '-';
            const fecha = record.data['A_Fecha'] || '-';
            const celular = record.data['RS_Celular'] || '-';
            const horaServicio = record.data['A_Check-IN'] || '-';
            const pagoAdelantado = parseFloat(record.data['RC_Pagos_Total']) || 0;
            const total = parseFloat(record.data['A_Total']) || 0;
            const status = getStatus(record.data);

            return `
                <div class="main-record-card fade-in" onclick="openModal(${index})">
                    <div class="record-header">
                        <div>
                            <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem;">${cliente}</h2>
                            <p style="color: var(--apple-text-secondary); font-size: 0.9rem;">Código: ${codigo}</p>
                        </div>
                        <span class="status-badge status-${status.class}">${status.label}</span>
                    </div>
                    
                    <div class="record-info-grid">
                        <div class="info-item">
                            <div class="info-label">Fecha</div>
                            <div class="info-value">${formatDate(fecha)}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Hora</div>
                            <div class="info-value">${horaServicio}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Celular</div>
                            <div class="info-value">${celular}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Total</div>
                            <div class="info-value">$${total.toFixed(2)}</div>
                        </div>
                    </div>

                    <div class="payment-summary">
                        <span class="payment-label">Monto Pagado</span>
                        <span class="payment-value">$${pagoAdelantado.toFixed(2)}</span>
                    </div>
                </div>
            `;
        }

        function createCompactRecordCard(record, index) {
            const cliente = record.data['RS_Nombre'] || '-';
            const fecha = record.data['A_Fecha'] || '-';
            const status = getStatus(record.data);

            return `
                <div class="compact-record" onclick="openModal(${index})">
                    <div class="compact-record-content">
                        <div class="compact-info">
                            <div class="compact-status">${status.label}</div>
                            <div class="compact-name">${cliente}</div>
                            <div class="compact-date">${formatDate(fecha)}</div>
                        </div>
                        <svg width="20" height="20" fill="none" stroke="#D2D2D7" stroke-width="2" viewBox="0 0 24 24">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </div>
                </div>
            `;
        }

        function openModal(index) {
            const record = allRecords[index];
            const cliente = record.data['RS_Nombre'] || '-';
            const codigo = record.data['RS_Id_Susc'] || '-';
            const fecha = record.data['A_Fecha'] || '-';
            const celular = record.data['RS_Celular'] || '-';
            const horaServicio = record.data['A_Check-IN'] || '-';
            const pagoAdelantado = parseFloat(record.data['RC_Pagos_Total']) || 0;
            const total = parseFloat(record.data['A_Total']) || 0;
            const status = getStatus(record.data);

            document.getElementById('modalBody').innerHTML = `
                <div class="modal-header-bg">
                    <div style="width: 64px; height: 64px; margin: 0 auto 1rem;">
                        <img src="https://i.ibb.co/HTyGwGhP/TUMSIN-FONDO-1024-X1024.png" style="width: 100%; border-radius: 12px;">
                    </div>
                    <h2 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.25rem;">Agenda TUM</h2>
                    <p style="font-size: 0.875rem; color: var(--apple-text-secondary);">Servicio de Limpieza Profesional</p>
                    
                    <div style="margin-top: 1rem; display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 0.875rem; font-weight: 600; color: white; background: ${status.class === 'realizado' ? 'var(--apple-blue)' : status.class === 'en-hora' ? 'var(--apple-green)' : '#FF9500'};">
                        ${status.label}
                    </div>
                </div>
                
                <div class="modal-grid">
                    <div class="modal-field-box">
                        <div class="modal-field-label-box">CÓDIGO</div>
                        <div class="modal-field-value-box">${codigo}</div>
                    </div>
                    <div class="modal-field-box">
                        <div class="modal-field-label-box">CLIENTE</div>
                        <div class="modal-field-value-box">${cliente}</div>
                    </div>
                    <div class="modal-field-box">
                        <div class="modal-field-label-box">FECHA</div>
                        <div class="modal-field-value-box">${formatDate(fecha)}</div>
                    </div>
                    <div class="modal-field-box">
                        <div class="modal-field-label-box">HORA</div>
                        <div class="modal-field-value-box">${horaServicio}</div>
                    </div>
                    <div class="modal-field-box" style="grid-column: span 2;">
                        <div class="modal-field-label-box">CELULAR</div>
                        <div class="modal-field-value-box">${celular}</div>
                    </div>
                </div>

                <div style="margin: 0 1.5rem 1.5rem; background: #F5F5F7; padding: 1.5rem; border-radius: 12px;">
                    <div style="font-size: 0.75rem; font-weight: 600; color: var(--apple-text-secondary); margin-bottom: 1rem;">DETALLE DE PAGO</div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="font-size: 0.9rem;">Total Servicio</span>
                        <span style="font-weight: 600;">$${total.toFixed(2)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 0.9rem; color: var(--apple-green);">Pagado</span>
                        <span style="font-weight: 700; color: var(--apple-green);">$${pagoAdelantado.toFixed(2)}</span>
                    </div>
                </div>
            `;

            const overlay = document.getElementById('modalOverlay');
            overlay.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
            document.body.style.overflow = '';
        }

        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        document.getElementById('searchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const searchValue = document.getElementById('searchInput').value.trim();
            if (!searchValue) return;

            const searchButton = document.getElementById('searchButton');
            const errorMessage = document.getElementById('errorMessage');
            const recordsContainer = document.getElementById('recordsContainer');
            const statsSection = document.getElementById('statsSection');
            const heroSection = document.getElementById('heroSection');

            // Show loading
            searchButton.disabled = true;
            searchButton.innerHTML = `<span style="display:inline-block; animation: spin 1s linear infinite; border: 2px solid rgba(255,255,255,0.3); border-top: 2px solid white; border-radius: 50%; width: 16px; height: 16px; vertical-align: middle; margin-right: 8px;"></span> Buscando...`;
            errorMessage.classList.add('hidden');
            recordsContainer.classList.add('hidden');
            statsSection.classList.remove('visible');
            statsSection.classList.add('hidden');

            try {
                const url = `${SCRIPT_URL}?RS_Id_Susc=${encodeURIComponent(searchValue)}`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);

                const result = await response.json();

                if (!result.success) throw new Error(result.message || 'Error al buscar datos');

                const data = result.data || [];

                allRecords = data.map((item, index) => {
                    const dateStr = item['A_Fecha'];
                    let date = null;
                    if (dateStr) {
                        const parsedDate = new Date(dateStr);
                        if (!isNaN(parsedDate.getTime())) {
                            date = parsedDate.toISOString();
                        }
                    }
                    return {
                        data: item,
                        date: date,
                        id: `record-${index}`,
                        index: index
                    };
                });

                allRecords.sort((a, b) => {
                    if (!a.date && !b.date) return 0;
                    if (!a.date) return 1;
                    if (!b.date) return -1;
                    return new Date(b.date).getTime() - new Date(a.date).getTime();
                });

                if (allRecords.length === 0) {
                    errorMessage.textContent = 'No se encontraron resultados para este código.';
                    errorMessage.classList.remove('hidden');
                } else {
                    // Ajustar hero section
                    heroSection.classList.add('with-results');
                    
                    // Mostrar estadísticas con animación
                    statsSection.classList.remove('hidden');
                    setTimeout(() => {
                        statsSection.classList.add('visible');
                    }, 100);

                    // Display records
                    const mainRecord = allRecords[0];
                    const otherRecords = allRecords.slice(1);

                    document.getElementById('mainRecord').innerHTML = createMainRecordCard(mainRecord, 0);
                    
                    if (otherRecords.length > 0) {
                        document.getElementById('otherRecords').innerHTML = otherRecords.map((record, i) => 
                            createCompactRecordCard(record, i + 1)
                        ).join('');
                    } else {
                        document.getElementById('otherRecords').innerHTML = `<div style="text-align:center; padding: 2rem; color: var(--apple-text-secondary); font-size: 0.875rem;">Sin historial previo</div>`;
                    }

                    updateStatistics(allRecords);
                    recordsContainer.classList.remove('hidden');
                }
            } catch (err) {
                errorMessage.textContent = err.message || 'Error de conexión. Intente nuevamente.';
                errorMessage.classList.remove('hidden');
            } finally {
                searchButton.disabled = false;
                searchButton.innerHTML = 'Consultar Estado';
            }
        });
    </script>
</body>
</html>




